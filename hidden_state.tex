\documentclass{article}
\usepackage{amsmath}
\pagestyle{empty}
\begin{document}

Consider an alphabet of symbols \{A,C\}, and an ordered configuration
from this alphabet. Each symbol is read using a process that miscalls
it with some error probability e.  We don't observe the actual
configuration; it is hidden.  The observed configuration is produced
from the hidden one through this calling process.  Formally:

\begin{align*}
h & \equiv \text{the hidden configuration} \\
o & \equiv \text{the observed configuration} \\
h[i] & \equiv \text{the i'th element of } h \\
h_A & \equiv \text{the number of A elements in } h \text{, }
= \sum_i \delta(h[i],A) \\
\text{with }\delta(p,q) & \equiv
\begin{cases}
  p = q & 1 \\
  p \neq q & 0
\end{cases}
\text{ and }
\bar{\delta}(p,q) \equiv
\begin{cases}
  p = q & 0 \\
  p \neq q & 1
\end{cases}
\end{align*}

We are interested in the likelihood of an observed configuration
arising from a hidden configuration.  This is specified in the usual
way as:

\begin{align}
  Pr(o,h;e) & \equiv Pr(o|h;e)Prior(h;\alpha) \\
  Dist(o,h) & \equiv \sum_i \bar{\delta}(o[i],h[i]) \\
  Pr(o|h;e) & \equiv e^{Dist(o,h)}(1-e)^{D-Dist(o,h)} \\
  Path(L;e) & \equiv Pr(o|h;e) \text{ s.t. } Dist(o,h) = L\\
  Pr(h|o;e) & \propto Pr(o,h;e) \nonumber
\end{align}

$Dist(o,h)$ is the number of elements that differ between $o$ and $h$.
$Pr(o|h;e)$ gives the probability of 'generating', or calling a
configuration $o$ from a configuration $h$ when a certain error
probability $e$ is in effect. Since we will later be interested in
just the distance between o and h, and not any specific $h$,
$Path(L;e)$ gives a notational convenience.

$Prior(h;\alpha)$ mentioned above hasn't been specified yet.  We
choose a prior to represent the process of founder base generation,
namely a two-stage model.  First, some symbol composition $C$ is
chosen from a Dirichlet distribution.  The Dirichlet is parameterized
by $\alpha$, and it is meant to represent the possible base
compositions of samples that might be sequenced.  Once a sample is
chosen, the individual founder bases (elements of $h$) are
independently drawn with replacement, from the composition $C$.  We
use replacement since the actual physical sample is so large that it
may as well be. This design gives rise to a distribution known as
multinomial-dirichlet, with the following form:

\begin{align}
Prior(h;\alpha) & \equiv \int_p{Dir(p;\alpha) Pr(h|p)dp}
= \frac{\Gamma(A)}{\Gamma(D+A)}
\prod_k \frac{\Gamma(h_k+\alpha_k)}{\Gamma(\alpha_k)} \\
\text{with } A & \equiv \sum_k \alpha_k \text{ and } D \equiv \sum_k h_k \nonumber \\
PriorComp(C;\alpha) & \equiv Prior(h;\alpha) \text{ for some } h \text{ s.t. } h_A = C_A, h_C = C_C
\end{align}

Now, ultimately we are interested in the likelihood of the set of
configurations $h$ having a particular symbol composition. Let
$S_{C,o,L}$ be the set of configurations $h$ where $(h_A,h_C) = C$ and
$Dist(h, o) = L$.

With the alphabet of two symbols A and C, there are four possible
categories of changes between $o$ and $h$, which we can depict with
the contingency table:

\begin{align*}
  \begin{matrix}
    n_{AA} & n_{AC} & h_A \\
    n_{CA} & n_{CC} & h_C \\
    o_A & o_C
  \end{matrix}
\end{align*}

with row and column sums shown.

\begin{align*}
  n_{pq} & \equiv \text{number of elements where } (h[i],o[i]) = (p,q) \\
  & = \sum_{i}^{D} \delta(h[i],p) \delta(o[i],q) \\
  n_{AC} + n_{CA} & \equiv L
\end{align*}

It works out that

\begin{align}
  n_{AA} & = \frac{h_A + o_A - L}{2} \nonumber \\
  n_{CC} & = \frac{h_C + o_C - L}{2} \nonumber \\
  |S_{C,o,L}| & = {o_A \choose n_{AA}} {o_C \choose n_{CC}}
\end{align}

As it turns out, every configuration $h \in S_{C,o,L}$ gives the same
value for $Pr(h, o; e)$.  This is because components $Prior(h;\alpha)$
depends only on $(h_A,h_C)$ (not on the specific permutation of the
elements of $h$), and $Pr(o|h;e)$ depends only on $Dist(h,o) = L$. So
we can write:

\begin{align}
  Posterior(C,o,L;e) & \equiv Pr(h \in S_{C,o,L},o;e) \\
  Pr(h \in S_{C,o,L}, o; e) & \equiv \sum_h^{S_{C,o,L}} Pr(h,o;e) \nonumber \\
  & = |S_{C,o,L}| Path(L;e) PriorComp(C;\alpha) \nonumber \\
  & = {o_A \choose n_{AA}}{o_C \choose n_{CC}}
  e^L(1-e)^{D-L}
  \frac{\Gamma(A)}{\Gamma(D+A)}
  \prod_k \frac{\Gamma(h_k+\alpha_k)}{\Gamma(\alpha_k)}
\end{align}

We are interested ultimately in computing

\begin{align}
  Posterior(C,o;e) & \equiv \sum_L Posterior(C,o,L;e) \nonumber \\
\end{align}




Consider a heuristic way to evaluate $Posterior(C,o;e)$. In 2D, the
non-zero components exist for every other value of L, i.e. (0,2,4,...)
or (1,3,5,...). For each value of $L$, the components of
$Posterior(C,o,L;e)$ differ from each other in $Path(L;e)$ and
$|S_{C,o,L}|$, but not in $PriorComp(C;\alpha)$. Let $v$ be the number
of positions that are $A$ in both $h$ and $o$:

\begin{align*}
  v \equiv \sum_i \delta(h[i],A)\delta(o[i],A)
\end{align*}

It follows that

\begin{align}
  L & \equiv (o_A-v) + (h_A-v) = h_A + o_A - 2v \nonumber \\
  v & = \frac{h_A + o_A - L}{2} \nonumber \\
  |S_{C,o,L}| & \equiv {o_A \choose v}{o_C \choose (h_A-v)} \nonumber
\end{align}

Now consider the change in these two factors when $L$ increases by 2
(thus, $v$ decreases by one, represented by $\check{v} = v - 1$):

\begin{align}
  \frac{|S_{C,o,L+2}|}{|S_{C,o,L}|}
  & \equiv
  \frac{{o_A \choose \check{v}}}{{o_A \choose v}}
  \frac{{o_C \choose h_A-\check{v}}}{{o_C \choose h_A-v}}
  = &
  \frac{v}{o_A-\check{v}}
  \frac{o_C-(h_A-v)}{h_A-\check{v}} \\[4ex]
  \frac{Path(L+2;e)}{Path(L;e)}
  & \equiv
  \frac{e^{L+2}(1-e)^{D-(L+2)}}{e^L(1-e)^{D-L}}
  = &
  \frac{e^2}{(1-e)^2}
\end{align}

So we see that the Path component decreases sharply.  The highest
error probabilities we will be considering are likely about $0.05$;
the Path factor change for this will be $0.002506$. The set size
$|S_{C,o,L}|$ increases depending on $v$ and $D$ mostly.


\begin{align}
  \frac{PriorComp(\{\check{x},\hat{y}\})}{Prior(\{x,y\})} & =
  \frac{\frac{N!}{\check{x}!\hat{y}!}}{\frac{N!}{x!y!}}
  \frac{\frac{\Gamma(A)}{\Gamma(N+A)}}{\frac{\Gamma(A)}{\Gamma(N+A)}}
  \frac{ \frac{\Gamma(\check{x}+\alpha_0)}{\Gamma(\alpha_0)} }{
    \frac{\Gamma(x+\alpha_0)}{\Gamma(\alpha_0)} } \frac{
    \frac{\Gamma(\hat{y}+\alpha_1)}{\Gamma(\alpha_1)} }{
    \frac{\Gamma(y+\alpha_1)}{\Gamma(\alpha_1)} } \nonumber \\[2ex] &
  = \frac{x!}{\check{x}!}  \frac{y!}{\hat{y}!}
  \frac{\hat{y}+\alpha_1}{x+\alpha_0} \nonumber \\ & =
  \frac{x}{x+\alpha_0} \frac{\hat{y}+\alpha_1}{\hat{y}}
\end{align}



\end{document}
